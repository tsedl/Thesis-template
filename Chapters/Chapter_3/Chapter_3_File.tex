%=== Chapter Three ===
\chapter{Fitting Smooth Arcs to Polygon Regions - Comparative Results}

\section{Introduction}
To understand the advantages of using clothoid pieces to join two poses in a 2D obstacle field, it is informative to compare the output paths with an alternative curve type. One well known option is to use polynomial curves of  degree 3. 

\section{Methodology}
The paths are compared on two simulated environments. One is dimensioned for a small AGV with turning radius 0.5m, as might be used to deliver small items in a flexible manufacturing environment. The unexpected obstacle completely blocks the path to the right as in Figure \ref{fig:env1}. The second could represent a fork lift type AGV with a larger turning radius of 2m, which is collecting standard size (1m x1.2m) pallets from a storage area. See Figure \ref{fig:env1}. The pallets are placed by human drivers, and a reliable system fo detecting their position and orientation is assumed to be in place. The AGV must manoeuvrer to the pose of a target pallet, without colliding with the others. Lower curvature and sharpness allow the AGV to traverse the path faster without compromising load stability.

\section{Algorithm}
Both methods decompose the problem into topology followed by curve fitting. The topology problem is a posed as a directed graph with weighted edges. There is a node for every intersection of the boundary between two regions. Nodes within the same region are fully connected. The weight of each edge corresponds to the euclidean distance between the two nodes. The A* Algorithm is used to search for the set of edges which give the minimum sum of weights between any start and end pose.

The sequence of edges is then used to populate the matrix $\bm{H} ^{(R \times P)} \in [0,1]$. This is a binary matrix containing $R$ columns, one for each of the $R$ polygonal regions which comprise the accessible space. Each row corresponds to one of the $P$ path pieces and contains a single non-zero element indicating the region to which is assigned. A path piece may be present in more than one region as the regions may be overlapping, but it must always remain completely inside its assigned region.

\subsection{Polynomial Method}
The problem specification calls for a path which changes smoothly in x, y, heading and curvature. This should start at a specified $x_s, y_s, \psi_s$ with zero curvature and end at $x_g, y_g, \psi_g$ with zero curvature.

\begin{equation}
\begin{array}{c}
x(t) = a + bt + ct^2 + dt^3 \\
y(t) = e + ft + gt^2 + ht^3 \\
\end{array}
\label{eq:spline}
\end{equation}

There is a unique solution for a cubic spline of with fixed (x, y, heading) at the start and goal, passing through fixed $x, y$ positions numbering $n$. A cubic spline defined by Equation \ref{eq:spline} has eight free parameters per segment. To give a unique solution, eight constraints are must be found for each segment. Passing through the $n$ waypoints at the end of each segment gives two, one for the $x$ coordinate and one for $y$. Enforcing continuity of position between the end of each segment and the next leads to two more. Four more can be determined from continuity in the first and second derivative of position for a total of eight. 

However, only four constraints are needed at the start and end of the spline. Fixing the final position and heading, the acceleration must be left free. Stacking the parameters into a vector 
\begin{equation}
\bm{p}_i = [a_i, b_i, c_i, d_i, e_i, f_i, g_i]^T
\end{equation} 
and 
\begin{equation}
\bm{p} = [\bm{p}_1,\cdots,\bm{p}_i, \cdots, \bm{p}_{n-1}]^T
\end{equation} 
leads to the system of linear equations is given in Equation \ref{eq:assembled}. 

\begin{equation}
[\bm{A}|\bm{b}_{x}] = \left[\begin{array}{cccccc|c}
\bm{A}_{0} & & & & \cdots & 0 & \bm{b}_{x0}\\
\bm{0} & \bm{A}_{1} & & & \cdots & 0 & \bm{b}_{x1}\\
\vdots & 	& \ddots &	& 	& \vdots	& \vdots \\
0 & & \cdots & \bm{A}_{i} &  \cdots & 0 & \bm{b}_{xi}\\
\vdots & 	& 	&	& \ddots  &		& \vdots \\
0 & \cdots &  &  & &  \bm{A}_{n} 			& \bm{b}_{xn}\\
\end{array}\right] 
\label{eq:assembled}
\end{equation}

Where
\begin{equation}
[\bm{A}_{0}|\bm{b}_{x0}] = \left[ \begin{array}{cccc|c}
1 & 0 & 0 & 0 & x_0\\
0 & 1 & 0 & 0 & \cos{\phi_0}\\
\end{array} \right] 
\label{eq:submatrix_0}
\end{equation}

\begin{equation}
[\bm{A}_{i}|\bm{b}_{xi}] = \left[\begin{array}{cccccccc|c}
1 & 1 & 1 & 1 & 0 & 0 & 0 & 0 & x_{i}\\
1 & 1 & 1 & 1 & -1 & 0 & 0 & 0 & 0\\
1 & 1 & 2 & 3 & 0 & -1 & 0 & 0 & 0\\
0 & 0 & 2 & 6 & 0 & 0 & -2 & 0 & 0
\end{array}\right]
\label{eq:submatrix_i}
\end{equation}

\begin{equation}
[\bm{A}_{n}|\bm{b}_{xn}] = \left[\begin{array}{cccccccc|c}
0 & 0 & 0 & 0 & 1 & 1 & 1 & 1 &x_n\\
0 & 1 & 0 & 0 & 0 & 1 & 2 & 3 & \cos{\psi_n}\\
\end{array}\right] 
\label{eq:submatrix_n}
\end{equation}

The $\bm{p}_x$ parameters to fit a set of $n$ waypoints can be found by computing $\bm{p}_x = \bm{A}^{-1}\bm{b}_x$. The $\bm{p}_y$ parameters can be found almost identically, by computing $\bm{p}_y=\bm{A}^{-1}\bm{b}_y$. Constraint vector $\bm{b}_y$ is instead constructed using the $y$ coordinates of the waypoints in $b_i$ and the $\sin$ of the start and end heading in $\bm{b}_{y0}$ and $\bm{b}_{yn}$.



\subsection{Clothoid Method}
